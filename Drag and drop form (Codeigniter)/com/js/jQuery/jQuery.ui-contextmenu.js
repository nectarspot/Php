(function(e,t,n,r){"use strict";function s(e){return e&&e.match(/^#/)?e.substring(1):e||""}var i="onselectstart"in n.createElement("div");e.widget("moogle.contextmenu",{version:"1.3.0-1",options:{delegate:null,hide:{effect:"fadeOut",duration:"fast"},ignoreParentSelect:true,menu:null,position:null,preventSelect:false,show:{effect:"slideDown",duration:"fast"},taphold:false,beforeOpen:e.noop,blur:e.noop,close:e.noop,create:e.noop,createMenu:e.noop,focus:e.noop,open:e.noop,select:e.noop},_create:function(){var t,r,s,o=this.options;this.$headStyle=null;this.$menu=null;this.menuIsTemp=false;this.currentTarget=null;if(o.preventSelect){s=(e(this.element).is(n)?e("body"):this.element).uniqueId().attr("id");t="#"+s+" "+o.delegate+" { "+"-webkit-user-select: none; "+"-khtml-user-select: none; "+"-moz-user-select: none; "+"-ms-user-select: none; "+"user-select: none; "+"}";this.$headStyle=e("<style class='moogle-contextmenu-style' />").prop("type","text/css").appendTo("head");try{this.$headStyle.html(t)}catch(u){this.$headStyle[0].styleSheet.cssText=t}if(i){this.element.delegate(o.delegate,"selectstart"+this.eventNamespace,function(e){e.preventDefault()})}}this._createUiMenu(o.menu);r="contextmenu"+this.eventNamespace;if(o.taphold){r+=" taphold"+this.eventNamespace}this.element.delegate(o.delegate,r,e.proxy(this._openMenu,this))},_destroy:function(){this.element.undelegate(this.eventNamespace);this._createUiMenu(null);if(this.$headStyle){this.$headStyle.remove();this.$headStyle=null}},_createUiMenu:function(t){if(this.isOpen()){this._closeMenu(true)}if(this.menuIsTemp){this.$menu.remove()}else if(this.$menu){this.$menu.menu("destroy").hide()}this.$menu=null;this.menuIsTemp=false;if(!t){return}else if(e.isArray(t)){this.$menu=e.moogle.contextmenu.createMenuMarkup(t);this.menuIsTemp=true}else if(typeof t==="string"){this.$menu=e(t)}else{this.$menu=t}this.$menu.hide().menu({blur:e.proxy(this.options.blur,this),create:e.proxy(this.options.createMenu,this),focus:e.proxy(this.options.focus,this),select:e.proxy(function(t,n){var r,i=n.item.has(">a[aria-haspopup='true']").length>0,o=n.item.find(">a"),u=o.data("actionHandler");n.cmd=s(o.attr("href"));n.target=e(this.currentTarget);if(!i||!this.options.ignoreParentSelect){r=this._trigger.call(this,"select",t,n);if(u){r=u.call(this,t,n)}if(r!==false){this._closeMenu.call(this)}t.preventDefault()}},this)})},_openMenu:function(t){var i=this.options,s=i.position,o=this,u={menu:this.$menu,target:e(t.target),extraData:t.extraData};this.currentTarget=t.target;t.preventDefault();if(this._trigger("beforeOpen",t,u)===false){this.currentTarget=null;return false}u.menu=this.$menu;e(n).bind("keydown"+this.eventNamespace,function(t){if(t.which===e.ui.keyCode.ESCAPE){o._closeMenu()}}).bind("mousedown"+this.eventNamespace+" touchstart"+this.eventNamespace,function(t){if(!e(t.target).closest(".ui-menu-item").length){o._closeMenu()}});if(e.isFunction(s)){s=s(t,u)}s=e.extend({my:"left top",at:"left bottom",of:t.pageX===r?t.target:t,collision:"fit"},s);this.$menu.show().css({position:"absolute",left:0,top:0}).position(s).hide();this._show(this.$menu,this.options.show,function(){o._trigger.call(o,"open",t,u)})},_closeMenu:function(t){var r=this,i=t?false:this.options.hide;e(n).unbind("mousedown"+this.eventNamespace).unbind("touchstart"+this.eventNamespace).unbind("keydown"+this.eventNamespace);r.currentTarget=null;this._hide(this.$menu,i,function(){r._trigger("close")})},_setOption:function(t,n){switch(t){case"menu":this.replaceMenu(n);break}e.Widget.prototype._setOption.apply(this,arguments)},_getMenuEntry:function(e,t){var n=this.$menu.find("li a[href=#"+s(e)+"]");return t?n.closest("li"):n},close:function(){if(this.isOpen()){this._closeMenu()}},enableEntry:function(e,t){this._getMenuEntry(e,true).toggleClass("ui-state-disabled",t===false)},getMenu:function(){return this.$menu},isOpen:function(){return!!this.$menu&&!!this.currentTarget},open:function(e,t){t=t||{};var n=jQuery.Event("contextmenu",{target:e.get(0),extraData:t});return this.element.trigger(n)},replaceMenu:function(e){this._createUiMenu(e)},setEntry:function(t,n){var r,i=this._getMenuEntry(t,false);if(typeof n==="string"){if(i.children("span").length){i.contents().filter(function(){return this.nodeType===3}).first().replaceWith(n)}else{i.text(n)}}else{r=i.closest("li").empty();n.cmd=n.cmd||t;e.moogle.contextmenu.createEntryMarkup(n,r)}},showEntry:function(e,t){this._getMenuEntry(e,true).toggle(t!==false)}});e.extend(e.moogle.contextmenu,{createEntryMarkup:function(t,n){var r=null;if(!/[^\-\u2014\u2013\s]/.test(t.title)){n.text(t.title)}else{r=e("<a/>",{text:""+t.title,href:"#"+s(t.cmd)}).appendTo(n);if(e.isFunction(t.action)){r.data("actionHandler",t.action)}if(t.uiIcon){r.append(e("<span class='ui-icon' />").addClass(t.uiIcon))}if(t.disabled){n.addClass("ui-state-disabled")}if(e.isPlainObject(t.data)){r.data(t.data)}}return r},createMenuMarkup:function(t,n){var r,i,s,o;if(n==null){n=e("<ul class='ui-helper-hidden' />").appendTo("body")}for(r=0;r<t.length;r++){i=t[r];o=e("<li/>").appendTo(n);e.moogle.contextmenu.createEntryMarkup(i,o);if(e.isArray(i.children)){s=e("<ul/>").appendTo(o);e.moogle.contextmenu.createMenuMarkup(i.children,s)}}return n}})})(jQuery,window,document)